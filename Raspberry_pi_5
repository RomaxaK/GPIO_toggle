import tkinter as tk
from tkinter import messagebox
from qorvo.rcc.ptc_versions.v3 import ptcdriver as ptcv3

class QPG6200GUI:
    def __init__(self, root):
        self.root = root
        self.root.title("QPG6200L Controller")

        self.tx_device = None

        tk.Button(root, text="Connect TX (QPG6200L - COM7)", command=self.connect_tx).pack(pady=10)
        self.tx_status = tk.Label(root, text="TX Status: Not connected", fg="red")
        self.tx_status.pack()

        tk.Button(root, text="TX ON", command=self.tx_on).pack(pady=10)

    def connect_tx(self):
        try:
            self.tx_device = ptcv3.PTC.new_connection("COM7:115200")
            info = self.tx_device.get_device_info()
            self.tx_status.config(text=f"TX Connected: {info}", fg="green")
            print(f"[TX] Connected to QPG6200L: {info}")
        except Exception as e:
            messagebox.showerror("Connection Error", str(e))
            self.tx_status.config(text="TX Status: Connection failed", fg="red")

    def tx_on(self):
        if not self.tx_device:
            messagebox.showwarning("Not Connected", "Please connect to QPG6200L first.")
            return
        try:
            self.tx_device.disable_rx_mode()
            self.tx_device.phy = self.tx_device.PhyMode.BLE
            self.tx_device.antenna = self.tx_device.AntennaValues.A1
            self.tx_device.channel = 20
            self.tx_device.packet_length = 40
            self.tx_device.power = 8
            self.tx_device.reset_packet_counters()
            self.tx_device.start_tx_packets(count=100, interval_ms=10)
            print("[TX] Transmission started (count=100, interval=10ms)")
        except Exception as e:
            messagebox.showerror("TX Error", str(e))

if __name__ == "__main__":
    root = tk.Tk()
    app = QPG6200GUI(root)
    root.mainloop()
